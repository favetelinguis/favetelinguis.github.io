<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Henke Larsson AB</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">Henke Larsson AB</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org699f7b3">About</a>
<ul>
<li><a href="#orgfc5da07">We are a consultancy company that <b>loves</b> to build software, your can contact us at <code>t1 at henkelarsson dot se</code>.</a></li>
</ul>
</li>
<li><a href="#orgc06bb9f">Wiki</a>
<ul>
<li><a href="#org074f9f6">How to setup a minor mode for my custom CLI wrapper</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org699f7b3" class="outline-2">
<h2 id="org699f7b3">About</h2>
<div class="outline-text-2" id="text-org699f7b3">
</div>
<div id="outline-container-orgfc5da07" class="outline-3">
<h3 id="orgfc5da07">We are a consultancy company that <b>loves</b> to build software, your can contact us at <code>t1 at henkelarsson dot se</code>.</h3>
</div>
</div>
<div id="outline-container-orgc06bb9f" class="outline-2">
<h2 id="orgc06bb9f">Wiki</h2>
<div class="outline-text-2" id="text-orgc06bb9f">
</div>
<div id="outline-container-org074f9f6" class="outline-3">
<h3 id="org074f9f6">How to setup a minor mode for my custom CLI wrapper</h3>
<div class="outline-text-3" id="text-org074f9f6">
<p>
Making an optimal workflow by wrapping common CLI tools in a transient.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example what args will look like ("--switch" "--text=WHAT is this text")</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lslha</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> args)
  <span style="font-style: italic;">"Observe hows arg can be passed directly as a list to subpocess making it easy to expand with more option without changing function."</span>
  (<span style="font-weight: bold;">interactive</span>
   (list (transient-args 'service-x-transient)))
  (<span style="font-weight: bold;">let</span> ((process <span style="font-style: italic;">"*my-process*"</span>)
        (buffer <span style="font-style: italic;">"*customer*"</span>))
    (<span style="font-weight: bold;">if</span> (member <span style="font-style: italic;">"--switch"</span> args)
        (<span style="font-weight: bold;">let</span> ((thing (thing-at-point 'word t)))
          (apply #'start-process process buffer <span style="font-style: italic;">"bb"</span> <span style="font-style: italic;">"-f"</span> (expand-file-name <span style="font-style: italic;">"~/repos/bab/script.clj"</span>) <span style="font-style: italic;">"-t"</span> thing args))
      (apply #'call-process <span style="font-style: italic;">"bb"</span> nil buffer nil <span style="font-style: italic;">"-f"</span> (expand-file-name <span style="font-style: italic;">"~/repos/bab/script.clj"</span>) args))
    (switch-to-buffer buffer)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">test-function</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> args)
  (<span style="font-weight: bold;">interactive</span>
   (list (transient-args 'service-x-transient)))
  (message <span style="font-style: italic;">"TEST"</span>))

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">transient</span>)
(transient-define-infix service:--text ()
  <span style="font-weight: bold;">:description</span> <span style="font-style: italic;">"Option with text"</span>
  <span style="font-weight: bold;">:class</span> 'transient-option
  <span style="font-weight: bold;">:argument</span> <span style="font-style: italic;">"--text="</span>
  <span style="font-weight: bold;">:shortarg</span> <span style="font-style: italic;">"-i"</span>
  )
(transient-define-infix service:--list ()
  <span style="font-weight: bold;">:description</span> <span style="font-style: italic;">"Option with list"</span>
  <span style="font-weight: bold;">:class</span> 'transient-option
  <span style="font-weight: bold;">:shortarg</span> <span style="font-style: italic;">"-l"</span>
  <span style="font-weight: bold;">:argument</span> <span style="font-style: italic;">"--list="</span>
  <span style="font-weight: bold;">:choices</span> '(<span style="font-style: italic;">"true"</span> <span style="font-style: italic;">"false"</span> <span style="font-style: italic;">"bit-true"</span> <span style="font-style: italic;">"bit-false"</span> <span style="font-style: italic;">"in-between"</span>))
(transient-define-prefix service-x-transient ()
  <span style="font-style: italic;">"Test Transient."</span>
  <span style="font-weight: bold;">:info-manual</span> <span style="font-style: italic;">"Tansient for service x"</span>
  [<span style="font-style: italic;">"Arguments"</span>
   (<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"Use thing at point"</span> <span style="font-style: italic;">"--switch"</span>)
   (service:--text)
   (service:--list)]
  [<span style="font-style: italic;">"Actions"</span>
   (<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Call lslha"</span> lslha)
   (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Transient 2"</span> test-function)
   (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Action d"</span> test-function)]
  [(<span style="font-style: italic;">"q"</span> <span style="font-style: italic;">"Quit"</span> transient-quit-one)])

(<span style="font-weight: bold;">define-minor-mode</span> <span style="font-weight: bold;">customer-minor-mode</span>
  <span style="font-style: italic;">"Minor mode for interactiong with my CLI tools"</span>
  <span style="font-weight: bold;">:lighter</span> <span style="font-style: italic;">" Cutomer"</span>
  <span style="font-weight: bold;">:keymap</span> (<span style="font-weight: bold;">let</span> ((map (make-sparse-keymap)))
            (define-key map (kbd <span style="font-style: italic;">"C-c m"</span>) 'service-x-transient)
            map))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">customer</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (switch-to-buffer <span style="font-style: italic;">"*customer*"</span>)
  (org-mode)
  (customer-minor-mode)
  (goto-char (point-max))
  (insert <span style="font-style: italic;">"* Welcome to Customer mode @ "</span> (current-time-string) <span style="font-style: italic;">"\n\n"</span>))
</pre>
</div>

<p>
Then create a babashka script at <code>~/repos/bab/script.clj</code> with something like.
</p>
<div class="org-src-container">
<pre class="src src-clojure">#!/usr/bin/env bb

(require '[clojure.tools.cli :refer [parse-opts]])

(def cli-options
  [["-p" "--port PORT" "Port number"
    :default 80
    :parse-fn #(Integer/parseInt %)
    ]
   ["-i" "--text TEXT" "Some text input"]
   ["-t" "--thing THING" "Thing at point"]
   ["-l" "--list LISP" "Some info from list argument"]
   ["-h" "--help"]])

(println "** Output\n" (:options (parse-opts *command-line-args* cli-options)))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)</p>
</div>
</body>
</html>
